# 财务数据接口文档

> **文档版本:** v2.0
> **更新日期:** 2025-11-15
> **接口来源:** 真实财务数据API
> **文档状态:** ✅ 已验证

---

## 1. 接口概述

### 1.1 基本信息

| 属性 | 值 |
|------|-----|
| **接口URL** | `http://ailianhuan.xyz:8333/financeDate/dataList` |
| **请求方法** | `POST` |
| **Content-Type** | `application/json` |
| **Swagger文档** | `http://ailianhuan.xyz:8333/v2/api-docs` |
| **在线文档** | `http://ailianhuan.xyz:8333/doc.html#/default/财务数据管理/getDataUsingPOST` |
| **接口描述** | 获取财务全量数据或按月筛选数据 |
| **认证方式** | 无需认证 |

### 1.2 接口特点

- ✅ **全量查询** - 无参数调用返回所有历史数据
- ✅ **按月过滤** - 支持通过 `keepDate` 参数按月查询
- ✅ **数据稳定** - 历史数据不变，仅月初新增数据
- ✅ **响应快速** - 全量数据响应时间 < 2秒
- ✅ **格式统一** - 标准JSON格式，包含code/msg/data

---

## 2. 数据规模分析

### 2.1 总体规模（截至2025-11-15）

| 维度 | 数量 |
|------|------|
| **总记录数** | 1,016 条 |
| **时间跨度** | 2023-11 至 2025-09（22个月） |
| **唯一公司数** | 13 个 |
| **财务类型数** | 7 种（01-04, 06-08） |
| **公司层级** | 2级（一级公司1个，二级公司12个） |

### 2.2 按月数据分布

| 月份 | 记录数 | 公司数 | 财务类型数 | 备注 |
|------|--------|--------|------------|------|
| 2023-11 | 10 | 10 | 1 | 最早数据 |
| 2024-01 | 26 | 11 | 6 | |
| 2024-02 | 26 | 11 | 6 | |
| 2024-03 | 26 | 11 | 6 | |
| 2024-04 | 26 | 11 | 6 | |
| 2024-05 | 26 | 11 | 6 | |
| 2024-06 | 26 | 11 | 6 | |
| 2024-07 | 26 | 11 | 6 | |
| 2024-08 | 26 | 11 | 6 | |
| 2024-09 | 24 | 11 | 4 | |
| 2024-10 | 26 | 11 | 6 | |
| 2024-11 | 64 | 11 | 7 | 数据增多 |
| 2024-12 | 22 | 11 | 2 | |
| 2025-01 | 78 | 12 | 7 | 新增公司 |
| 2025-02 | 78 | 12 | 7 | |
| 2025-03 | 78 | 12 | 7 | |
| 2025-04 | 72 | 12 | 7 | |
| 2025-05 | 70 | 12 | 7 | |
| 2025-06 | 70 | 12 | 7 | |
| 2025-07 | 70 | 12 | 7 | |
| 2025-08 | 73 | 13 | 7 | 新增公司 |
| 2025-09 | 73 | 13 | 7 | 最新数据 |

**数据特点：**
- 单月数据量：20-80条（平均约50条）
- 数据增长趋势：2025年后数据更加完整
- 数据更新频率：月初更新（推测每月1-5号）

### 2.3 公司列表

| 公司名称 | 公司编号 | 层级 | 记录数 | 备注 |
|---------|----------|------|--------|------|
| 集团(合) | lhjt | 0（一级） | 129 | 总公司 |
| 股份(合) | lhjthb | 1（二级） | 79 | |
| 联博(合) | lbyyhb | 1（二级） | 79 | |
| 联通医药 | ltyyhb | 1（二级） | 94 | |
| 基因(合) | ydjyhb | 1（二级） | 45 | |
| 产业(合) | jkcyhb | 1（二级） | 79 | |
| 普林斯(合) | plshb | 1（二级） | 94 | |
| 圣氏化学 | sshx | 1（二级） | 73 | |
| 颐和堂 | yhtzy | 1（二级） | 93 | |
| 华天宝 | htb | 1（二级） | 93 | |
| 国药控股 | gykg | 1（二级） | 73 | |
| 医疗器械 | (未知编号) | 1（二级） | 6 | 2025年新增 |
| 萨恩公司 | (未知编号) | 1（二级） | 79 | 2025年新增 |

### 2.4 财务类型分布

| 类型编号 | 类型名称 | 记录数 | 占比 |
|---------|---------|--------|------|
| 01 | 营业收入 | 254 | 25.0% |
| 02 | 利润总额 | 242 | 23.8% |
| 03 | 实现税金 | 129 | 12.7% |
| 04 | 入库税金 | 129 | 12.7% |
| 06 | 净利润 | 120 | 11.8% |
| 07 | 实现税金(扬州地区) | 71 | 7.0% |
| 08 | 入库税金(扬州地区) | 71 | 7.0% |

**注意：** 缺少类型 `05 - 所得税` 数据

---

## 3. 请求参数

### 3.1 参数说明

| 参数名 | 类型 | 必填 | 位置 | 说明 | 示例 |
|--------|------|------|------|------|------|
| `keepDate` | String | 否 | Query | 记账日期，格式：YYYY-MM-DD | `2024-03-01` |

**参数规则：**
- ✅ **不传参数** - 返回全部历史数据（1016条）
- ✅ **传入keepDate** - 返回指定月份的数据（20-80条）
- ⚠️ **日期格式** - 必须为 `YYYY-MM-DD` 格式，通常为每月1号
- ⚠️ **无效日期** - 返回空数组（不会报错）

### 3.2 请求示例

#### 3.2.1 全量查询（无参数）

**cURL:**
```bash
curl -X POST "http://ailianhuan.xyz:8333/financeDate/dataList" \
  -H "Content-Type: application/json"
```

**Python (requests):**
```python
import requests

url = "http://ailianhuan.xyz:8333/financeDate/dataList"
response = requests.post(url)
data = response.json()

print(f"总记录数: {len(data['data'])}")
```

**JavaScript (fetch):**
```javascript
const url = 'http://ailianhuan.xyz:8333/financeDate/dataList';
const response = await fetch(url, { method: 'POST' });
const data = await response.json();

console.log(`总记录数: ${data.data.length}`);
```

#### 3.2.2 按月查询

**cURL:**
```bash
curl -X POST "http://ailianhuan.xyz:8333/financeDate/dataList?keepDate=2024-03-01" \
  -H "Content-Type: application/json"
```

**Python:**
```python
import requests

url = "http://ailianhuan.xyz:8333/financeDate/dataList"
params = {"keepDate": "2024-03-01"}
response = requests.post(url, params=params)
data = response.json()

print(f"2024年3月记录数: {len(data['data'])}")
```

**JavaScript:**
```javascript
const url = 'http://ailianhuan.xyz:8333/financeDate/dataList?keepDate=2024-03-01';
const response = await fetch(url, { method: 'POST' });
const data = await response.json();

console.log(`2024年3月记录数: ${data.data.length}`);
```

---

## 4. 响应格式

### 4.1 响应结构

```json
{
  "code": "0000",
  "msg": "success",
  "data": [
    {
      "id": "1",
      "companyNo": "lhjt",
      "companyId": 1,
      "companyName": "集团(合)",
      "typeNo": "01",
      "keepDate": "2024-01-01",
      "currentAmt": 66455.17,
      "lastYearAmt": 46842.14,
      "lastYearTotalAmt": 46842.14,
      "thisYearTotalAmt": 66455.17,
      "addAmt": 19613.03,
      "addRate": 41.87,
      "yearAddAmt": 19613.03,
      "yearAddRate": 41.87,
      "level": "0",
      "remarks": null,
      "highCompanyNo": null,
      "companyAddress": null,
      "subCompany": null,
      "createBy": null,
      "createTime": null,
      "updateBy": null,
      "updateTime": null,
      "delFlag": "0"
    }
  ]
}
```

### 4.2 响应码说明

| Code | Message | 说明 |
|------|---------|------|
| `0000` | success | 请求成功 |
| 其他 | (待补充) | 错误信息 |

### 4.3 数据字段详解

#### 4.3.1 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `id` | String | ✅ | 记录唯一标识 | `"1"` |
| `companyNo` | String | ✅ | 公司编号 | `"lhjt"` |
| `companyId` | Integer | ✅ | 公司ID | `1` |
| `companyName` | String | ✅ | 公司名称 | `"集团(合)"` |
| `typeNo` | String | ✅ | 财务类型编号（01-08） | `"01"` |
| `keepDate` | String | ✅ | 记账日期（YYYY-MM-DD） | `"2024-01-01"` |
| `level` | String | ✅ | 公司层级（0=一级，1=二级） | `"0"` |

#### 4.3.2 财务金额字段（单位：万元）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `currentAmt` | Float | 当期金额 | `66455.17` |
| `lastYearAmt` | Float | 去年同期金额 | `46842.14` |
| `lastYearTotalAmt` | Float | 去年累计金额 | `46842.14` |
| `thisYearTotalAmt` | Float | 今年累计金额 | `66455.17` |

#### 4.3.3 增长指标字段

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `addAmt` | Float | 月环比增减额（万元） | `19613.03` |
| `addRate` | Float | 月环比增长率（%） | `41.87` |
| `yearAddAmt` | Float | 年同比增减额（万元） | `19613.03` |
| `yearAddRate` | Float | 年同比增长率（%） | `41.87` |

**计算公式：**
```
月环比增减额 = currentAmt - lastYearAmt (同月对比)
月环比增长率 = (addAmt / lastYearAmt) × 100

年同比增减额 = thisYearTotalAmt - lastYearTotalAmt
年同比增长率 = (yearAddAmt / lastYearTotalAmt) × 100
```

#### 4.3.4 扩展字段

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `remarks` | String | 备注信息 | `null` |
| `highCompanyNo` | String | 上级公司编号 | `null` |
| `companyAddress` | String | 公司地址 | `null` |
| `subCompany` | Array | 子公司列表（递归结构） | `null` |
| `delFlag` | String | 删除标记（0=正常） | `"0"` |
| `createBy` | String | 创建人 | `null` |
| `createTime` | String | 创建时间 | `null` |
| `updateBy` | String | 更新人 | `null` |
| `updateTime` | String | 更新时间 | `null` |

---

## 5. 财务类型映射表

### 5.1 完整映射

| 类型编号 | 类型名称 | 英文名称 | 说明 |
|---------|---------|---------|------|
| `01` | 营业收入 | Operating Revenue | 企业主营业务收入 |
| `02` | 利润总额 | Total Profit | 利润总额（税前） |
| `03` | 实现税金 | Tax Achieved | 实际实现的税金总额 |
| `04` | 入库税金 | Tax Paid | 实际入库的税金 |
| `05` | 所得税 | Income Tax | **数据缺失** |
| `06` | 净利润 | Net Profit | 税后净利润 |
| `07` | 实现税金(扬州地区) | Tax Achieved (Yangzhou) | 扬州地区实现税金 |
| `08` | 入库税金(扬州地区) | Tax Paid (Yangzhou) | 扬州地区入库税金 |

### 5.2 常用别名映射

| 用户输入 | 映射类型编号 | 类型名称 |
|---------|-------------|---------|
| 营收、收入、营业额 | `01` | 营业收入 |
| 利润、盈利 | `02` | 利润总额 |
| 净利、税后利润 | `06` | 净利润 |
| 税金、税收 | `03` | 实现税金 |
| 入库税 | `04` | 入库税金 |

---

## 6. 公司层级结构

### 6.1 层级说明

```
集团(合) [level=0, companyNo=lhjt]
├── 股份(合) [level=1, companyNo=lhjthb]
├── 联博(合) [level=1, companyNo=lbyyhb]
├── 联通医药 [level=1, companyNo=ltyyhb]
├── 基因(合) [level=1, companyNo=ydjyhb]
├── 产业(合) [level=1, companyNo=jkcyhb]
├── 普林斯(合) [level=1, companyNo=plshb]
├── 圣氏化学 [level=1, companyNo=sshx]
├── 颐和堂 [level=1, companyNo=yhtzy]
├── 华天宝 [level=1, companyNo=htb]
├── 国药控股 [level=1, companyNo=gykg]
├── 医疗器械 [level=1]
└── 萨恩公司 [level=1]
```

### 6.2 层级规则

- **Level 0** - 一级公司（集团总部），仅1个
- **Level 1** - 二级公司（子公司），共12个
- **高级公司字段** - 当前数据中 `highCompanyNo` 均为 `null`
- **子公司字段** - 当前数据中 `subCompany` 均为 `null`（未使用递归结构）

---

## 7. 数据查询优化建议

### 7.1 查询策略

**✅ 推荐做法：**

1. **按月查询** - 每次查询指定月份，减少数据传输
   ```python
   # 好：单月查询（返回约50条）
   GET /financeDate/dataList?keepDate=2024-03-01
   ```

2. **本地缓存** - 历史数据不变，可本地缓存
   ```python
   # 首次全量同步
   sync_all_data()  # 1016条

   # 后续仅同步最新月份
   sync_latest_month()  # 仅50-80条
   ```

3. **数据库存储** - 存储到本地PostgreSQL，避免频繁API调用
   ```python
   # 一次性同步到本地数据库
   # 后续查询直接走本地，响应时间 < 100ms
   ```

**❌ 不推荐做法：**

1. **实时全量查询** - 每次查询都拉取1016条数据
2. **频繁API调用** - AI对话每次查询都调用外部API
3. **无缓存机制** - 重复查询相同数据

### 7.2 性能对比

| 查询方式 | 数据量 | 响应时间 | 带宽消耗 | 适用场景 |
|---------|--------|---------|---------|---------|
| 全量查询 | 1016条 | ~2秒 | ~200KB | 首次全量同步 |
| 按月查询 | 50-80条 | ~500ms | ~10KB | 增量同步 |
| 本地数据库 | 任意 | <100ms | 0 | AI实时查询 |

---

## 8. 数据示例

### 8.1 完整记录示例

```json
{
  "id": "65",
  "createBy": null,
  "createTime": null,
  "updateBy": null,
  "updateTime": null,
  "delFlag": "0",
  "companyNo": "lhjt",
  "companyId": 1,
  "typeNo": "01",
  "currentAmt": 54362.20,
  "lastYearAmt": 57072.90,
  "lastYearTotalAmt": 151199.21,
  "thisYearTotalAmt": 159189.51,
  "addAmt": -2710.70,
  "addRate": -4.75,
  "yearAddAmt": 7990.31,
  "yearAddRate": 5.28,
  "keepDate": "2024-03-01",
  "remarks": null,
  "companyName": "集团(合)",
  "highCompanyNo": null,
  "companyAddress": null,
  "level": "0",
  "subCompany": null
}
```

**数据解读：**
- 公司：集团(合)
- 财务类型：01（营业收入）
- 月份：2024年3月
- 当月收入：5.44亿元
- 月环比：下降4.75%（-2710.70万元）
- 年同比：增长5.28%（+7990.31万元）
- 今年累计：15.92亿元

### 8.2 多条记录示例（按月查询）

```json
{
  "code": "0000",
  "msg": "success",
  "data": [
    {
      "id": "65",
      "companyName": "集团(合)",
      "typeNo": "01",
      "keepDate": "2024-03-01",
      "currentAmt": 54362.20,
      "yearAddRate": 5.28
    },
    {
      "id": "67",
      "companyName": "股份(合)",
      "typeNo": "01",
      "keepDate": "2024-03-01",
      "currentAmt": 21271.22,
      "yearAddRate": 19.78
    },
    {
      "id": "79",
      "companyName": "集团(合)",
      "typeNo": "02",
      "keepDate": "2024-03-01",
      "currentAmt": 8073.47,
      "yearAddRate": -8.07
    }
  ]
}
```

---

## 9. 常见问题（FAQ）

### Q1: 为什么全量查询返回1016条而非更多？

**A:** 这是截至2025年9月的全部历史数据。数据从2023年11月开始，按月增长。每月1-5号会新增当月数据（约50-80条）。

### Q2: keepDate 参数可以传任意日期吗？

**A:** 建议传每月1号（如 `2024-03-01`），因为数据库中的 `keepDate` 字段都是月初日期。传其他日期会返回空数组。

### Q3: 数据单位是什么？

**A:** 所有金额字段单位为**万元**。例如 `currentAmt: 66455.17` 表示 6.65亿元。

### Q4: 为什么缺少类型05（所得税）？

**A:** 当前数据源未提供所得税数据，仅包含7种财务类型（01-04, 06-08）。

### Q5: 如何高效查询？

**A:** 推荐方案：
1. **首次**：全量同步到本地数据库（1016条）
2. **后续**：每月仅同步最新月份数据（50-80条）
3. **查询**：直接从本地数据库查询，响应时间<100ms

### Q6: 数据更新频率是多少？

**A:** 根据历史数据推测，每月1-5号更新上月数据。建议定时任务设置为**每月1号凌晨4点**执行同步。

### Q7: subCompany 字段如何使用？

**A:** 当前所有记录的 `subCompany` 均为 `null`，表明未使用递归子公司结构。公司层级通过 `level` 字段区分（0=集团，1=子公司）。

---

## 10. 附录

### 10.1 Python完整示例

```python
import requests
from typing import List, Dict, Optional

class FinanceAPIClient:
    """财务数据API客户端"""

    BASE_URL = "http://ailianhuan.xyz:8333"

    def get_all_data(self) -> List[Dict]:
        """获取全量数据"""
        url = f"{self.BASE_URL}/financeDate/dataList"
        response = requests.post(url, timeout=10)
        response.raise_for_status()
        data = response.json()

        if data.get("code") != "0000":
            raise Exception(f"API错误: {data.get('msg')}")

        return data.get("data", [])

    def get_data_by_month(self, keep_date: str) -> List[Dict]:
        """按月查询数据

        Args:
            keep_date: 记账日期，格式：YYYY-MM-DD，如 "2024-03-01"
        """
        url = f"{self.BASE_URL}/financeDate/dataList"
        params = {"keepDate": keep_date}
        response = requests.post(url, params=params, timeout=10)
        response.raise_for_status()
        data = response.json()

        if data.get("code") != "0000":
            raise Exception(f"API错误: {data.get('msg')}")

        return data.get("data", [])

    def get_company_data(self, company_no: str, type_no: Optional[str] = None) -> List[Dict]:
        """查询指定公司的数据

        Args:
            company_no: 公司编号，如 "lhjt"
            type_no: 财务类型编号，如 "01"（可选）
        """
        all_data = self.get_all_data()

        filtered = [
            record for record in all_data
            if record["companyNo"] == company_no
        ]

        if type_no:
            filtered = [
                record for record in filtered
                if record["typeNo"] == type_no
            ]

        return filtered

# 使用示例
if __name__ == "__main__":
    client = FinanceAPIClient()

    # 1. 获取全量数据
    all_data = client.get_all_data()
    print(f"总记录数: {len(all_data)}")

    # 2. 按月查询
    march_data = client.get_data_by_month("2024-03-01")
    print(f"2024年3月记录数: {len(march_data)}")

    # 3. 查询集团营业收入
    revenue = client.get_company_data("lhjt", "01")
    print(f"集团营业收入记录数: {len(revenue)}")

    # 4. 数据分析
    for record in revenue[:3]:
        print(f"{record['keepDate']}: {record['currentAmt']:.2f}万元")
```

### 10.2 数据分析示例

```python
import pandas as pd

# 将数据转换为DataFrame
df = pd.DataFrame(all_data)

# 按公司统计
company_stats = df.groupby('companyName').agg({
    'id': 'count',
    'currentAmt': 'sum'
}).rename(columns={'id': '记录数', 'currentAmt': '累计金额'})

print(company_stats.sort_values('累计金额', ascending=False))

# 按财务类型统计
type_stats = df.groupby('typeNo').agg({
    'id': 'count',
    'currentAmt': ['mean', 'sum']
})

print(type_stats)
```

---

## 11. 版本历史

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v2.0 | 2025-11-15 | 基于真实API `/financeDate/dataList` 重写文档 |
| v1.0 | (已废弃) | 基于错误的6个接口编写（已删除） |

---

## 12. 相关文档

- [财务数据库设计方案](./02_财务数据库设计方案.md)
- [财务数据同步方案](./03_财务数据同步方案.md)
- [AI对话集成方案v2](./04_AI对话集成方案_v2.md)
- [财务数据实施路线图](./05_财务数据实施路线图.md)

---

**文档维护:** AI助手 + 开发团队
**反馈渠道:** 项目issue或直接联系开发负责人
